# 2.44

## 练习 2.44 请定义出corner-split里使用的过程up-split，它与right-split类似，除在其中交换了below和beside的角色之外。

---

暂未找到如何用 Scheme 操纵浏览器元素的简单方案，先用 JavaScript 来探索一下。这里重要的是通过高阶函数，使得在画面的操作被延迟到所有变换做完之后才执行。另外，为了能够方便地进行函数组合，需要将这些可以组合的函数的类型签名设计成一致。这里使用了 framedPainter，它的类型是 (x, y, w, h) -> ctx -> void。

由于所有的 framedPainter 都是这个类型，从而可以相互组合，并且组合完成后依然是 framedPainter，即  (x, y, w, h) -> ctx -> void。

<img src='https://images.ctfassets.net/qixg1o8tujmf/7m0jrKYaDBwEvlc5lo8nt6/6d50a5050d9cdc0d4d2047e35feac292/10648733_696750647079056_2800539603462658695_o.jpg' alt='Jeff Tian' style="width: 10px; height: 10px;" id="jeff-tian">


### the Jeff Tian painter 
<canvas id="my-canvas" style="max-width: 300px;"></canvas>

```eval-js
img = document.querySelector('#jeff-tian');

const framedPainter = (frameX, frameY, frameWidth, frameHeight) => (painter) => {
    painter(frameX, frameY, frameWidth, frameHeight);
};

drawToFrame = (frame, width, height) => (framedPainter) => {
    const canvas = document.querySelector(frame);
    canvas.width = width;
    canvas.height = height;

    const ctx = canvas.getContext('2d');
    framedPainter(ctx);
};

const createPainter = (image, sourceX, sourceY, sourceWidth, sourceHeight) => (frameX, frameY, frameWidth, frameHeight) => (ctx) => {
    ctx.drawImage(image, sourceX, sourceY, sourceWidth, sourceHeight, frameX, frameY, frameWidth, frameHeight);
};

// (x, y, w, h) -> ctx -> void
jeffTianPainter = createPainter(img, 0, 0, img.naturalWidth, img.naturalHeight);

onLoadOrLoadAlready = (img, handler) => {
    if(img.complete) {
        handler();
    }

    img.addEventListener('load', handler);
}; 

onLoadOrLoadAlready(img, () => drawToFrame('#my-canvas', img.naturalWidth, img.naturalHeight)(jeffTianPainter(0, 0, img.naturalWidth, img.naturalHeight)));

img.onerror = () => {
    location.reload();
};
```


### beside
<canvas id="beside-canvas" style="max-width: 300px;"></canvas>

```eval-js
// ((x, y, w, h) -> ctx -> void, 
// (x, y, w, h) -> ctx -> void) ->
// (x, y, w, h) -> ctx -> void
beside = (painter1, painter2) => (x, y, w, h) => (ctx) => {
    ctx.save();
    painter1(x, y, Math.floor(w/2), h)(ctx);
    ctx.restore();
    ctx.save();
    painter2(x + Math.floor(w/2) + 1, y, Math.ceil(w/2), h)(ctx);
    ctx.restore();
};

// (x, y, w, h) -> ctx -> void
const besidePainter = beside(jeffTianPainter, jeffTianPainter);

onLoadOrLoadAlready(img, () => drawToFrame('#beside-canvas', img.naturalWidth, img.naturalHeight)(besidePainter(0, 0, img.naturalWidth, img.naturalHeight)));
```

### below
<canvas id="below-canvas" style="max-width: 300px;"></canvas>

```eval-js
below = (painter1, painter2) => (x, y, w, h) => (ctx) => {
    ctx.save();
    painter1(x, y, w, Math.floor(h/2))(ctx);
    ctx.restore();
    ctx.save();
    painter2(x, y + Math.floor(h/2)+1, w, Math.ceil(h/2))(ctx);
    ctx.restore();
};

const belowPainter = below(jeffTianPainter, jeffTianPainter);

onLoadOrLoadAlready(img, () => drawToFrame('#below-canvas', img.naturalWidth, img.naturalHeight)(belowPainter(0, 0, img.naturalWidth, img.naturalHeight)));

```

### flip-vert
<canvas id="flip-vert-canvas" style="max-width: 300px;"></canvas>

```eval-js
// painter -> ctx -> void
flipVert = (painter) => (x, y, w, h) => (ctx) => {
    ctx.save();
    ctx.scale(1, -1);
    painter(x, -y, w, -h)(ctx);
    ctx.restore();
}

const flipVertPainter = flipVert(jeffTianPainter);

onLoadOrLoadAlready(img, () => drawToFrame('#flip-vert-canvas', img.naturalWidth, img.naturalHeight)(flipVertPainter(0, 0, img.naturalWidth, img.naturalHeight)));

```

### flip-horiz

<canvas id="flip-horiz-canvas" style="max-width: 300px;"></canvas>

```eval-js
const flipHoriz = (painter) => (x, y, w, h) => (ctx) => {
    ctx.save();
    ctx.scale(-1, 1);
    painter(-x, y, -w, h)(ctx);
    ctx.restore();
};
const flipHorizPainter = flipHoriz(jeffTianPainter);
onLoadOrLoadAlready(img, ()=>drawToFrame('#flip-horiz-canvas', img.naturalWidth, img.naturalHeight)(flipHorizPainter(0, 0, img.naturalWidth, img.naturalHeight)));
```

### wave2 with Jeff Tian Painter
<canvas id="wave2-canvas" style="max-width: 300px;"></canvas>

```eval-js
wave2 = beside(jeffTianPainter, flipVert(jeffTianPainter));

onLoadOrLoadAlready(img, () => drawToFrame('#wave2-canvas', img.naturalWidth, img.naturalHeight)(wave2(0, 0, img.naturalWidth, img.naturalHeight)));
```

### wave4 with Jeff Tian Painter
<canvas id="wave4-canvas" style="max-width: 400px;"></canvas>

```eval-js
const wave4 = below(wave2, wave2);

onLoadOrLoadAlready(img, () => drawToFrame('#wave4-canvas', img.naturalWidth, img.naturalHeight)(wave4(0, 0, img.naturalWidth, img.naturalHeight)));
```

### flipped-pairs with jeffTianPainter

<canvas id="flipped-pairs-canvas" style="max-width: 400px;"></canvas>

```eval-js
const flippedPairs = (painter) => {
    const painter2 = beside(painter, flipVert(painter));

    return below(painter2, painter2);
}

const wave4 = flippedPairs(jeffTianPainter);

onLoadOrLoadAlready(img, () => drawToFrame('#flipped-pairs-canvas', img.naturalWidth, img.naturalHeight)(wave4(0, 0, img.naturalWidth, img.naturalHeight)));
```

### 通过递归在图形的右边做分割和分支

<canvas id="right-split-1-canvas" style="max-width: 200px;"></canvas>

```eval-js
/**

/------------------------\
|           |            |
|           |  rightSplit|
|           |     n-1    |
|  identity |------------|
|           |            |
|           |  rightSplit|
|           |     n-1    |
\-----------|------------/

*/

rightSplit = (painter, n) => {
    if (n === 0) {
        return painter;
    }

    const smaller = rightSplit(painter, n - 1);
    return beside(painter, below(smaller, smaller));
};

const rightSplit1 = rightSplit(jeffTianPainter, 1);

onLoadOrLoadAlready(img, () => drawToFrame('#right-split-1-canvas', img.naturalWidth, img.naturalHeight)(rightSplit1(0, 0, img.naturalWidth, img.naturalHeight)));
```

<canvas id="right-split-4-canvas" style="max-width: 500px;"></canvas>

```eval-js
const rightSplit1 = rightSplit(jeffTianPainter, 4);

onLoadOrLoadAlready(img, () => drawToFrame('#right-split-4-canvas', img.naturalWidth, img.naturalHeight)(rightSplit1(0, 0, img.naturalWidth, img.naturalHeight)));
```


```eval-js
// placeholder, nothing here
```