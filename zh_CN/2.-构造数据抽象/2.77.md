# 2.77

## 练习 2.77 Louis Reasoner 试着去求值 `(magnitude z)`，其中的z就是图2-24里的那个对象。令他吃惊的是，从`apply-generic`出来的不是5而是一个错误信息，说没办法对类型`(complex)`做操作`magnitude`。他将这次交互的情况给Alyssa P. Hacker看，Alyssa说“问题出在没有为`complex`数定义复数选择函数，而只是为`polar`和`rectangular`数定义了它们。你需要做的就是在`complex`包里加入下面这些东西”：

```plain
(put 'real-part '(complex) real-part)
(put 'imag-part '(complex) imag-part)
(put 'magnitude '(complex) magnitude)
(put 'angle '(complex) angle)
```

请详细说明为什么这样做是可行的。作为一个例子，请考虑表达式`(magnitude z)`的求值过程，其中z就是图2-24里展示的那个对象，请追踪一下这一求值过程中的所有函数调用。特别是看看`apply-generic`被调用了几次？每次调用中分派的是哪个过程？

---

![](./2.77/2-24.jpg)

先来测试一下 `apply` 函数 

```eval-scheme
' expect 10
(apply + (list 1 2 3 4))
```


```eval-scheme
(define (apply-generic op . args)
    (let ((type-tags (map type-tags args)))
        (let ((proc (get op type-tags)))
            (if proc
                (apply proc (map contents args))
                (error
                    "No method for these types -- APPLY-GENERIC"
                    (list op type-tags)
                )
            )
        )
    )
)
```