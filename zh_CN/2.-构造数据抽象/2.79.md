# 2.79

## 练习 2.79 请定义一个通用型相等谓词 equ?，它能检查两个数是否相等。请将它安装到通用算术包里。这一操作应该能处理常规的数、有理数和复数。

---

先看一下原本的效果，以 add 为例：

```eval-scheme
(define helper (js-eval "const table = {}; function get (op, type) {console.log('getting ', op, type);    return table[op][JSON.stringify(type)];} function put (op,type, proc) {    table[op] = table[op] || {};    table[op][JSON.stringify(type)] = proc; } const exports = {get, put, table}; exports;"))

(define JSON (js-eval "JSON"))
```

```eval-scheme
(define (get op type)
    (js-invoke helper 'get op type)
)

(define (put op type proc)
    (js-invoke helper 'put op type proc)
)
```

```eval-scheme
(define (error msg v)
    msg
)
```
```eval-scheme
(define (attach-tag type-tag contents)
    (cons type-tag contents)
)

(define (type-tag datum)
    (if (pair? datum)
        (car datum)
        'scheme-number
    )
)

(define (contents datum)
    (if (pair? datum)
        (cdr datum)
        datum
    )
)

(define (apply-generic op . args)
    (let ((type-tags (map type-tag args)))
        (let ((proc (get op '(scheme-number, scheme-number))))
            (if proc
                (apply proc (map contents args))
                (error
                    "No method for these types -- APPLY-GENERIC"
                    (list op type-tags)
                )
            )
        )
    )
)

(define (equ? x y) (apply-generic 'equ? x y))

(define (install-scheme-number-package)
    (define (tag x) (attach-tag 'scheme-number x))

    (put 'equ? '(scheme-number, scheme-number) (lambda (x y) (tag (equ? x y))))
    (put 'make 'scheme-number (lambda (x) (tag x)))

    'done
)

(install-scheme-number-package)
```

```eval-scheme
(define (make-scheme-number n)
    ((get 'make 'scheme-number) n)
)

(define a (make-scheme-number 1))
(define b (make-scheme-number 2))

(equ? a b)
```
